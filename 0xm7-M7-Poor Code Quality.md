# M7：クライアントコードの品質

<table>
 <tr>
  <th>脅威エージェント</th>
  <th>攻撃経路</th>
  <th colspan="2">セキュリティ上の弱点</th>
  <th>技術的な影響</th>
  <th>ビジネスへの影響</th>
 </tr>
 <tr>
  <td align="center" width="20%">アプリ依存 </td>
  <td align="center" width="15%">攻撃難易度<br>困難</td>
  <td align="center" width="15%">蔓延度<br>中</td>
  <td align="center" width="15%">検出難易度<br>困難</td>
  <td align="center" width="17.5%">影響度<br>中</td>
  <td align="center" width="17.5%">アプリ / ビジネス依存</td>
 </tr>
 <tr>
  <td>モバイルコード内で呼び出されたメソッドに信頼できない入力値を渡せてしまうことは脅威となります。これらの問題は、必ずしもそれ自身がセキュリティ的に問題だとは言えませんが、セキュリティ脆弱性の原因となります。例えば、古いバージョンのSafar(脆弱性のある低品質なコード)に存在するバッファオーバーフローにより、ハイリスクなJailbreakによる攻撃をもたらしました。低品質なコードによる問題は、通常、マルウェアやフィッシング詐欺で悪用されます。</td>
  <td>攻撃者は通常、慎重に作成された入力値を被害者に送信することによって本カテゴリの脆弱性を悪用します。これらの入力値は、攻撃が実行されるモバイルデバイス内のコードへ渡されます。典型的な種類の攻撃では、メモリリークとバッファオーバーフローが悪用されるでしょう。</td>
  <td colspan="2">コード品質の問題は、ほとんどのモバイルコードにかなりよく見られます。幸い、ほとんどのコード品質の問題はほぼ良性であり、悪いプログラミング例ということで終わります。通常、手動のコードレビューでは、こういった種類の問題を検出することは難しいです。攻撃者はサードパーティの静的解析ツールやファジング実施ツールを使用するでしょう。これらの種類のツールでは、悪いプログラミング例といわれるメモリリーク、バッファオーバーフロー、その他のそれほど深刻ではない問題を見つけられるでしょう。ほとんど知識や経験のないハッカーでも、これらの種類の問題をうまく悪用することができます。モバイルコードのアドレス空間で外部コードを実行することが典型的な主な目標となります。</td>
  <td>本カテゴリに分類されるほとんどの攻撃では、外部コードの実行や（モバイルデバイス自身ではなく）リモートサーバ上のエンドポイントのサービス妨害(DoS)を引き起こします。しかしながら、モバイルデバイス内に、バッファオーバーフロー/オーバーランが存在し、入力値が外部集合から派生する場合、かなり深刻な技術的影響がある可能性があるため、修正されるべきです。</td>
  <td>本カテゴリの脆弱性によるビジネスへの影響は、エクスプロイトの性質によって、非常に広範囲に及びます。リモートコード実行となる低品質なコードによる問題は、以下のようなビジネスへの影響につながる可能性があります。
   <ul>
    <li> 情報の窃取</li>
    <li> 風評被害</li>
    <li> 知的財産の窃取</li>
   </ul>
   その他、それほど深刻ではない技術的な問題は、パフォーマンスやメモリ使用率の悪化や、フロントエンドのアーキテクチャの不備につながるかもしれません。
  </td>
 </tr>
</table>



## 脆弱性有無の確認
本カテゴリは、モバイルクライアントのコードレベルの実装の問題についてまとめています。サーバサイドのコーディングミスとは異なります。これらには、バッファオーバーフロー、フォーマットストリング、その他のコードレベルのミスといった脆弱性がもたらすリスクが含まれ、モバイルデバイスで動いているコードを書き換えることで解決します。

プログラミング言語自体(たとえば、Java、Swift、Objective C、JavaScript)のことを指しているため、M1(Improper Platform Usage：プラットフォームの不適切な利用)とは異なります。C言語のバッファオーバーフローや、モバイルアプリケーションのWebViewにおけるDOM-based XSSは、コード品質の問題によるものです。

本リスクの重要な特徴は、モバイルデバイス上でコードが実行されることであり、コードを局所的に変更する必要があることです。リスクを修正するには、ほとんどの場合においてプログラムの修正が必要ですが、このコード品質の問題の場合、間違ったAPIの使用、APIの安全でない使用、プログラミング言語の安全でない構文の使用、その他のコードレベルの問題によってリスクが発生します。重要なことは、サーバ上で実行するコードではく、モバイルデバイス自体で実行される悪いコードによってもたらされるリスクであるということです。

## 防止方法
一般的にコード品質の問題は、以下を実施することによって回避することが可能です。
 - 組織の全員が合意する一貫したコーディングパターンを維持すること。
 - 可読性が高く、一般的な記述方法でプログラムを記述すること。
 - バッファを使用するときは、受信するバッファデータの長さが対象とするバッファの長さを超えていないか常に検証すること。
 - 自動化によって、サードパーティの静的解析ツールを使用してバッファオーバーフローとメモリリークを見つけること。
 - その他の「コード品質」問題より、バッファオーバーフローやメモリリークの解決を優先すること。
 

## 攻撃シナリオの例
**シナリオ #1：** バッファオーバーフローの例

```
include <stdio.h>
int main(int argc, char **argv){
    char buf[8];    // buffer for eight characters
    gets(buf);    // read from stdio (sensitive function!)
    printf("%s\n", buf);    // print out data stored in buf
    return 0;    // 0 as return value
}
```
[このページ](https://www.owasp.org/index.php/Buffer_overflow_attack)から取得したこの例では、バッファオーバーフローを防ぐためにgets関数の使用を避けるべきです。これはほとんどの静的解析ツールがコード品質の問題として報告する例です。


## 参考資料
### OWASP
 - [Buffer Overflow Examples](https://www.owasp.org/index.php/Buffer_overflow_attack)

### 外部リンク 
 - [CWE-Common Weakness Enumeration](http://cwe.mitre.org/)
